# Makefile for Roots
# Requires AMU 5.17 or later


-include include/mk

CC = cc
MAKE = amu
LINK ?= link


CCFLAGS = -c -throwback -depend !Depend -IC: $(EXTRAFLAGS) -strict -fah $(FLAGS)

NORMALLIBS = \
	C:o.stubs\
	C:Lua.lib.luacore\
	C:Lua.lib.luastdlib\
	C:AJWLib.o.AJWLib\
	C:Desk.o.Desk

32BITLIBS = \
	C32:o.stubs\
	C32:Lua.lib.luacore\
	C32:Lua.lib.luastdlib\
	C32:AJWLib.o.AJWLib\
	C32:Desk.o.Desk

MEMCHECKLIBS = \
	C:stubs.o.asstubs\
	C:Lua.lib.luacoremc\
	C:Lua.lib.luastdlibmc\
	C:AJWLib.mc.AJWLib\
	MemCheck:o.MC\
	C:Desk.o.Desk

LIBS ?= $(NORMALLIBS)

OBJECTS = \
	Modules.o\
	Graphics.o\
	Windows.o\
	TreeLayout.o\
	Config.o\
	Layout.o\
	Draw.o\
	File.o\
	Print.o\
	Drawfile.o\
	Database.o\
	Shareware.o\
	EditGraphics.o\
	Main.o

TARGET = !RunImage

all: $(TARGET)

$(TARGET): $(OBJECTS)
	$(LINK) -o $@ $(LINKFLAGS) $(OBJECTS) $(LIBS)
	$(SQUEEZE)

.c.o:
	$(MEMCHECK) $(CC) $(CCFLAGS) $< -o $@

#dist: normal
#	rm log
#	rm clf
#	cd ..
#	rm webjames.zip
#	copy C:regex !WebJames.regex A~C~DF~L~N~P~QRS~T~V
#	zip -r -9 webjames/zip !WebJames Site Licence -x */o/* o/* *Makefile *CVS* *Debug* *zip* *regex/main
#	rm !WebJames.regex
#	cd !WebJames

debug: clean
	echo EXTRAFLAGS = -g|JLINK = drlink|JLINKFLAGS = -d { > include/mk }
	$(MAKE)

normal: clean
	echo EXTRAFLAGS = -Otime|JSQUEEZE = Squeeze -f $(TARGET) { > include/mk }
	$(MAKE)

32bit: clean
	echo LIBS = $(32BITLIBS)|JEXTRAFLAGS = -APCS 3/32bit/fpe3 { > include/mk }
	$(MAKE)

memcheck: clean
	echo LIBS = $(MEMCHECKLIBS)|JMEMCHECK = Memcheck.CC|JEXTRAFLAGS = -g|JLINK = drlink|JLINKFLAGS = -d { > include/mk }
	$(MAKE)

#!Run: !Run-in
#	sed $(REGEXP) < !Run-in > !Run
#	SetType !Run Obey

clean:
	rm *.o
	rm $(TARGET)


# Dynamic dependencies:
o.EditGraphics: c.EditGraphics C:Desk.h.Window C:Desk.h.Wimp C:Desk.h.Core C:h.kernel C:Desk.h.WimpSWIs C:Desk.h.Error2 C:Desk.h.Error C:Desk.h.JumpRaw C:Desk.h.Debug C:Desk.h.Pointer C:Desk.h.Icon C:Desk.h.DragASpr C:Desk.h.Coord C:Desk.h.Core C:Desk.h.Error C:Desk.h.Error2 C:Desk.h.SWI C:Desk.h.Event C:Desk.h.EventMsg C:Desk.h.Handler C:Desk.h.Hourglass C:Desk.h.Icon C:Desk.h.Menu C:Desk.h.Msgs C:Desk.h.Drag C:Desk.h.Resource C:Desk.h.Sprite C:Desk.h.Screen C:Desk.h.Template C:Desk.h.LinkList C:Desk.h.File C:Desk.h.Filing C:Desk.h.Sprite C:Desk.h.Screen C:Desk.h.Keycodes C:Desk.h.GFX C:Desk.h.Save C:Desk.h.Str C:Desk.h.Font2 C:Desk.h.Font C:Desk.h.ColourTran C:Desk.h.DeskMem C:Desk.h.Pane2 C:AJWLib.h.Error2 C:AJWLib.h.Window C:Desk.h.Sprite C:AJWLib.h.Menu C:AJWLib.h.Assert C:AJWLib.h.Msgs C:Desk.h.Window C:Desk.h.Icon C:AJWLib.h.Icon C:AJWLib.h.Flex C:Desk.h.Core C:h.kernel C:AJWLib.h.Font C:AJWLib.h.ColourPicker C:AJWLib.h.Str C:AJWLib.h.Draw C:AJWLib.h.DrawFile C:Desk.h.Wimp C:AJWLib.h.DrawFile h.EditGraphics h.Draw h.Windows h.DatabaseStruct h.LayoutStruct h.DatabaseStruct h.WindowsStruct h.DatabaseStruct
